"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),CFCMimg=function(){function e(t,i){_classCallCheck(this,e),this.initVal(t,i)}return _createClass(e,[{key:"getId",value:function(e){return document.getElementById(e)}},{key:"initVal",value:function(e,t){var i={canvaspart:"canvaspart",id:"divcenter",fileid:"files",imgid:"canvasimg",realcanvas:"realcanvas",rulenum:2,step:5,wid:230,hei:130,canvaspartwid:530,canvasparthei:300,scale:1,scalerate:1,scrollid:"progress",scrollsonid:"innergress",rateshow:"rateshow",slider:!1};this.cfg={};_extends(this.cfg,i,e);this.initCommonVal()}},{key:"getStyle",value:function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null)[t]:e.currentStyle[t]}},{key:"getoffset",value:function(e,t){if(null==e)return t;t||((t={}).top=0,t.left=0);var i=this.getStyle(e,"position");if("absolute"==i||"relative"==i){if(e.getBoundingClientRect&&null!=navigator.userAgent.toLowerCase().match(/.(msie)/))return t.top+=e.getBoundingClientRect().top,t.left+=e.getBoundingClientRect().left,t;t.top+=e.offsetTop,t.left+=e.offsetLeft}else t.top+=0,t.left+=0;return this.getoffset(e.parentElement,t)}},{key:"initCommonVal",value:function(){var e=this.cfg;e.slider&&(e.sliderobj=this.getId(e.slider)),e.canvaspartobj=this.getId(e.canvaspart),e.canvasimgobj=this.getId(e.imgid),e.centerdivobj=this.getId(e.id),e.fileobj=this.getId(e.fileid),e.scrollobj=this.getId(e.scrollid),e.scrollsonobj=this.getId(e.scrollsonid),e.rateshowobj=this.getId(e.rateshow),null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/)?console.warn("对不起,您的浏览器版本过低,请升级浏览器"):this.fileclick()}},{key:"fileclick",value:function(){var e=this.cfg,t=this;e.fileobj.onchange=function(){e.fileinfo={},e.fileinfo.size=this.files[0].size,e.fileinfo.type=this.files[0].type,e.fileinfo.name=this.files[0].name,e.fileinfo.path=this.value,e.fileinfo.files=this.files[0],t.canvas()}}},{key:"canvas",value:function(){var e=this.cfg,t=this;if(e.centerdivobj=this.getId(e.id),null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/))console.warn("ie9浏览器,不支持filereader,需要上传文件"),e.img=new Image,e.img.src=e.fileinfo.name,e.img.onload=function(){e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2,t.canvasevent(),t.scrollevent()};else{var i=new FileReader;i.readAsDataURL(e.fileinfo.files),i.onload=function(a){e.readerimg=i.result,e.img=new Image,e.img.src=e.readerimg,e.img.onload=function(){e.originimginfo={width:e.img.width,height:e.img.height},e.wid*e.rulenum/e.originimginfo.width>=e.hei*e.rulenum/e.originimginfo.height?e.wid*e.rulenum/e.originimginfo.width>=1?(e.maxscaleval=Math.ceil(e.wid*e.rulenum/e.originimginfo.width),e.minscaleval=e.maxscaleval/2):(e.maxscaleval=1,e.minscaleval=(e.wid/e.originimginfo.width).toFixed(2)):e.hei*e.rulenum/e.img.height>=1?(e.maxscaleval=Math.ceil(e.hei*e.rulenum/e.originimginfo.height),e.minscaleval=e.maxscaleval/2):(e.maxscaleval=1,e.minscaleval=(e.hei/e.originimginfo.width).toFixed(2)),e.scalerate=e.scale=e.maxscaleval,e.img.width=e.img.width*e.maxscaleval,e.img.height=e.img.height*e.maxscaleval,e.canvasimgobj.setAttribute("src",e.readerimg),e.canvasimgobj.style.width=e.img.width+"px",e.canvasimgobj.style.height=e.img.height+"px",e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2,e.canvasimgobj.style.left=e.dfx+"px",e.canvasimgobj.style.top=e.dfy+"px",t.canvasevent(),t.scrollevent(),t.canvastoimg(e.dfx,e.dfy)}}}}},{key:"canvasevent",value:function(){var e=this.cfg,t=this;e.canvaspyl={x:0+e.dfx,y:0+e.dfy};var i={},a={},n=!1;e.centerdivobj.onmousedown=function(l){var s=window.event||l;s.preventDefault&&s.preventDefault(),i.x=s.clientX,i.y=s.clientY,n=!0,e.centerdivobj.onmousemove=function(l){if(1==n){(l=window.event||l).preventDefault&&l.preventDefault(),a.x=l.clientX,a.y=l.clientY,Math.abs(a.x-i.x)>e.step&&(a.x-i.x>0?e.canvaspyl.x=e.step+e.canvaspyl.x:e.canvaspyl.x=-e.step+e.canvaspyl.x),Math.abs(a.y-i.y)>e.step&&(a.y-i.y>0?e.canvaspyl.y=e.step+e.canvaspyl.y:e.canvaspyl.y=-e.step+e.canvaspyl.y);var s=e.canvaspartwid/2-e.wid/2,o=e.canvaspartwid/2+e.wid/2,c=e.canvasparthei/2-e.hei/2,r=e.canvasparthei/2+e.hei/2;e.canvaspyl.x>s&&(e.canvaspyl.x=s),e.canvaspyl.x+e.img.width<o&&(e.canvaspyl.x=-(e.img.width-o)),e.canvaspyl.y>c&&(e.canvaspyl.y=c),e.canvaspyl.y+e.img.height<r&&(e.canvaspyl.y=-(e.img.height-r)),e.canvasimgobj.style.left=e.canvaspyl.x+"px",e.canvasimgobj.style.top=e.canvaspyl.y+"px",t.canvastoimg(e.canvaspyl.x,e.canvaspyl.y)}},e.centerdivobj.onmouseup=function(t){(t=window.event||t).preventDefault&&t.preventDefault(),e.centerdivobj.onmousemove=null,n=!1},e.centerdivobj.onmouseout=function(t){(t=window.event||t).preventDefault&&t.preventDefault(),e.centerdivobj.onmousemove=null,n=!1}}}},{key:"scrollevent",value:function(){var e=this.cfg;if(e.scrollsonobj.style.width=e.scrollobj.clientWidth+"px",e.rateshowobj.textContent=e.maxscaleval,e.slider)e.sliderobj.onmousemove=function(t){t=window.event||t,e.rateshowobj.textContent=e.sliderobj.value,e.scalerate=e.sliderobj.value,e.rateshowobj.textContent=1*e.scalerate,e.canvasimgobj.style.width=e.originimginfo.width*e.scalerate+"px",e.canvasimgobj.style.height=e.originimginfo.height*e.scalerate+"px",e.img.width=e.originimginfo.width*e.scalerate,e.img.height=e.originimginfo.height*e.scalerate,e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2,e.canvasimgobj.style.left=e.dfx+"px",e.canvasimgobj.style.top=e.dfy+"px",that.canvastoimg(e.dfx,e.dfy)};else{console.log("模拟滚动条进入");var t=this.cfg,i=this,a=this.getoffset(t.scrollobj),n=a.left,l=(a.top,{}),s={},o={x:0,y:0},c=!1;t.scrollobj.onmousedown=function(e){e.preventDefault(),l.x=e.clientX-n,c=!0,t.scrollobj.onmousemove=function(e){1==c&&(e.preventDefault(),s.x=e.clientX-n,o.x=s.x-l.x,o.x>=t.scrollobj.clientWidth&&(o.x=t.scrollobj.clientWidth),o.x+l.x>t.scrollobj.clientWidth?(t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px",t.scalerate=t.scale):(o.x+l.x)/(t.scrollobj.clientWidth/t.scale)<=t.minscaleval?(t.scalerate=t.minscaleval,t.scrollsonobj.style.width=t.scrollobj.clientWidth/t.scale*t.minscaleval+"px"):(t.scrollsonobj.style.width=o.x+l.x+"px",t.scalerate=((o.x+l.x)/(t.scrollobj.clientWidth/t.scale)).toFixed(1)),t.rateshowobj.textContent=1*t.scalerate,t.canvasimgobj.style.width=t.originimginfo.width*t.scalerate+"px",t.canvasimgobj.style.height=t.originimginfo.height*t.scalerate+"px",t.img.width=t.originimginfo.width*t.scalerate,t.img.height=t.originimginfo.height*t.scalerate,t.dfx=(t.canvaspartobj.clientWidth-t.img.width)/2,t.dfy=(t.canvaspartobj.clientHeight-t.img.height)/2,t.canvasimgobj.style.left=t.dfx+"px",t.canvasimgobj.style.top=t.dfy+"px",i.canvastoimg(t.dfx,t.dfy))},t.scrollobj.onmouseup=function(e){e.preventDefault(),t.scrollobj.onmousemove=null,e.clientX-n>t.scrollobj.clientWidth?(t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px",t.scalerate=t.scale):(e.clientX-n)/(t.scrollobj.clientWidth/t.scale)<=t.minscaleval?(t.scalerate=t.minscaleval,t.scrollsonobj.style.width=t.scrollobj.clientWidth/t.scale*t.minscaleval+"px"):(t.scrollsonobj.style.width=o.x+l.x+"px",t.scalerate=((o.x+l.x)/(t.scrollobj.clientWidth/t.scale)).toFixed(1)),t.rateshowobj.textContent=1*t.scalerate,t.canvasimgobj.style.width=t.originimginfo.width*t.scalerate+"px",t.canvasimgobj.style.height=t.originimginfo.height*t.scalerate+"px",t.img.width=t.originimginfo.width*t.scalerate,t.img.height=t.originimginfo.height*t.scalerate,t.dfx=(t.canvaspartobj.clientWidth-t.img.width)/2,t.dfy=(t.canvaspartobj.clientHeight-t.img.height)/2,t.canvasimgobj.style.left=t.dfx+"px",t.canvasimgobj.style.top=t.dfy+"px",i.canvastoimg(t.dfx,t.dfy),c=!1},t.scrollobj.onmouseout=function(e){e.preventDefault(),t.scrollobj.onmousemove=null,c=!1}}}}},{key:"canvastoimg",value:function(e,t){var i=this.cfg;i.canvasobj=this.getId(i.realcanvas),i.cxt=i.canvasobj.getContext("2d");var a=i.canvaspartwid/2-i.wid/2,n=i.canvasparthei/2-i.hei/2;i.dx=Math.abs(e-a)/i.scalerate,i.dy=Math.abs(t-n)/i.scalerate,i.cxt.clearRect(0,0,i.canvasobj.width,i.canvasobj.height),i.cxt.drawImage(i.img,i.dx,i.dy,i.wid/i.scalerate,i.hei/i.scalerate,0,0,i.wid,i.hei)}}]),e}();
export function CFCMimg(param) {
	return new CFCMimg(param)
}
