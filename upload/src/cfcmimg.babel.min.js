"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,i,l){return i&&e(t.prototype,i),l&&e(t,l),t}}(),CFCMimg=function(){function e(t,i){_classCallCheck(this,e),this.initVal(t,i)}return _createClass(e,[{key:"getId",value:function(e){return document.getElementById(e)}},{key:"initVal",value:function(e,t){var i={canvaspart:"canvaspart",id:"divcenter",fileid:"files",imgid:"canvasimg",realcanvas:"realcanvas",rulenum:2,step:5,wid:230,hei:130,canvaspartwid:530,canvasparthei:300,scale:1,scalerate:1,scrollid:"progress",scrollsonid:"innergress",rateshow:"rateshow",slider:!1};this.cfg={};_extends(this.cfg,i,e);this.initCommonVal()}},{key:"getStyle",value:function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null)[t]:e.currentStyle[t]}},{key:"getoffset",value:function(e,t){if(null==e)return t;t||((t={}).top=0,t.left=0);var i=this.getStyle(e,"position");if("absolute"==i||"relative"==i){if(e.getBoundingClientRect&&null!=navigator.userAgent.toLowerCase().match(/.(msie)/))return t.top+=e.getBoundingClientRect().top,t.left+=e.getBoundingClientRect().left,t;t.top+=e.offsetTop,t.left+=e.offsetLeft}else t.top+=0,t.left+=0;return this.getoffset(e.parentElement,t)}},{key:"initCommonVal",value:function(){var e=this.cfg;e.slider&&(e.sliderobj=this.getId(e.slider)),e.canvaspartobj=this.getId(e.canvaspart),e.canvasimgobj=this.getId(e.imgid),e.centerdivobj=this.getId(e.id),e.fileobj=this.getId(e.fileid),e.scrollobj=this.getId(e.scrollid),e.scrollsonobj=this.getId(e.scrollsonid),e.rateshowobj=this.getId(e.rateshow),null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/)?console.warn("对不起,您的浏览器版本过低,请升级浏览器"):this.fileclick()}},{key:"fileclick",value:function(){var e=this.cfg,t=this;e.fileobj.onchange=function(){e.fileinfo={},e.fileinfo.size=this.files[0].size,e.fileinfo.type=this.files[0].type,e.fileinfo.name=this.files[0].name,e.fileinfo.path=this.value,e.fileinfo.files=this.files[0],t.canvas()}}},{key:"canvas",value:function(){var e=this.cfg,t=this;if(e.centerdivobj=this.getId(e.id),null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/))console.warn("ie9浏览器,不支持filereader,需要上传文件"),e.img=new Image,e.img.src=e.fileinfo.name,e.img.onload=function(){e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2,t.canvasevent(),t.scrollevent()};else{var i=new FileReader;i.readAsDataURL(e.fileinfo.files),i.onload=function(l){e.readerimg=i.result,e.img=new Image,e.img.src=e.readerimg,e.img.onload=function(){e.originimginfo={width:e.img.width,height:e.img.height},e.wid*e.rulenum/e.originimginfo.width>=e.hei*e.rulenum/e.originimginfo.height?e.wid*e.rulenum/e.originimginfo.width>=1?(e.maxscaleval=Math.ceil(e.wid*e.rulenum/e.originimginfo.width),e.minscaleval=e.maxscaleval/2):(e.maxscaleval=1,e.minscaleval=(e.wid/e.originimginfo.width).toFixed(2)):e.hei*e.rulenum/e.img.height>=1?(e.maxscaleval=Math.ceil(e.hei*e.rulenum/e.originimginfo.height),e.minscaleval=e.maxscaleval/2):(e.maxscaleval=1,e.minscaleval=(e.hei/e.originimginfo.width).toFixed(2)),e.scalerate=e.scale=e.maxscaleval,e.img.width=e.img.width*e.maxscaleval,e.img.height=e.img.height*e.maxscaleval,e.canvasimgobj.setAttribute("src",e.readerimg),e.canvasimgobj.style.width=e.img.width+"px",e.canvasimgobj.style.height=e.img.height+"px",e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2,e.movepyl={cx:e.dfx-e.canvaspartwid/2,cy:e.dfy-e.canvasparthei/2,left:e.dfx-e.canvaspartwid/2,top:e.dfy-e.canvasparthei/2,reslenx:e.dfx-e.canvaspartwid/2,resleny:e.dfy-e.canvasparthei/2},console.log(e.movepyl,"from img load"),e.canvasimgobj.style.left=e.dfx+"px",e.canvasimgobj.style.top=e.dfy+"px",t.canvasevent(),t.scrollevent(),t.canvastoimg(e.dfx,e.dfy)}}}}},{key:"canvasevent",value:function(){var e=this.cfg,t=this,i={},l={},a=!1;e.centerdivobj.onmousedown=function(o){var n=window.event||o;n.preventDefault&&n.preventDefault(),i.x=n.clientX,i.y=n.clientY,a=!0,e.centerdivobj.onmousemove=function(o){if(1==a){(o=window.event||o).preventDefault&&o.preventDefault(),l.x=o.clientX,l.y=o.clientY,Math.abs(l.x-i.x)>e.step&&(l.x-i.x>0?e.movepyl.left=e.step+e.movepyl.left:e.movepyl.left=-e.step+e.movepyl.left),Math.abs(l.y-i.y)>e.step&&(l.y-i.y>0?e.movepyl.top=e.step+e.movepyl.top:e.movepyl.top=-e.step+e.movepyl.top);var n=e.canvaspartwid/2-e.wid/2,s=e.canvaspartwid/2+e.wid/2,c=e.canvasparthei/2-e.hei/2,r=e.canvasparthei/2+e.hei/2;e.movepyl.left>n&&(e.movepyl.left=n),e.movepyl.left+e.img.width<s&&(e.movepyl.left=-(e.img.width-s)),e.movepyl.top>c&&(e.movepyl.top=c),e.movepyl.top+e.img.height<r&&(e.movepyl.top=-(e.img.height-r)),e.canvasimgobj.style.left=e.movepyl.left+"px",e.canvasimgobj.style.top=e.movepyl.top+"px",e.movepyl.left=e.movepyl.left,e.movepyl.top=e.movepyl.top,e.movepyl.reslenx=e.movepyl.cx-e.movepyl.left,e.movepyl.resleny=e.movepyl.cy-e.movepyl.top,t.canvastoimg(e.movepyl.left,e.movepyl.top)}},e.centerdivobj.onmouseup=function(t){(t=window.event||t).preventDefault&&t.preventDefault(),e.centerdivobj.onmousemove=null,a=!1},e.centerdivobj.onmouseout=function(t){(t=window.event||t).preventDefault&&t.preventDefault(),e.centerdivobj.onmousemove=null,a=!1}}}},{key:"scrollevent",value:function(){var e=this.cfg;if(e.scrollsonobj.style.width=e.scrollobj.clientWidth+"px",e.rateshowobj.textContent=e.maxscaleval,e.slider)e.sliderobj.onmousemove=function(t){t=window.event||t,e.rateshowobj.textContent=e.sliderobj.value,e.scalerate=e.sliderobj.value,this.samedeal(),that.canvastoimg(e.dfx,e.dfy)};else{console.log("模拟滚动条进入");var t=this.cfg,i=this,l=this.getoffset(t.scrollobj),a=l.left,o=(l.top,{}),n={},s={x:0,y:0},c=!1;t.scrollobj.onmousedown=function(e){e.preventDefault(),o.x=e.clientX-a,c=!0,t.scrollobj.onmousemove=function(e){1==c&&(e.preventDefault(),n.x=e.clientX-a,s.x=n.x-o.x,s.x>=t.scrollobj.clientWidth&&(s.x=t.scrollobj.clientWidth),s.x+o.x>t.scrollobj.clientWidth?(t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px",t.scalerate=t.scale):(s.x+o.x)/(t.scrollobj.clientWidth/t.scale)<=t.minscaleval?(t.scalerate=t.minscaleval,t.scrollsonobj.style.width=t.scrollobj.clientWidth/t.scale*t.minscaleval+"px"):(t.scrollsonobj.style.width=s.x+o.x+"px",t.scalerate=((s.x+o.x)/(t.scrollobj.clientWidth/t.scale)).toFixed(1)),this.samedeal(),i.canvastoimg(t.dfx,t.dfy))},t.scrollobj.onmouseup=function(e){e.preventDefault(),t.scrollobj.onmousemove=null,e.clientX-a>t.scrollobj.clientWidth?(t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px",t.scalerate=t.scale):(e.clientX-a)/(t.scrollobj.clientWidth/t.scale)<=t.minscaleval?(t.scalerate=t.minscaleval,t.scrollsonobj.style.width=t.scrollobj.clientWidth/t.scale*t.minscaleval+"px"):(t.scrollsonobj.style.width=s.x+o.x+"px",t.scalerate=((s.x+o.x)/(t.scrollobj.clientWidth/t.scale)).toFixed(1)),this.samedeal(),i.canvastoimg(t.dfx,t.dfy),c=!1},t.scrollobj.onmouseout=function(e){e.preventDefault(),t.scrollobj.onmousemove=null,c=!1}}}}},{key:"samedeal",value:function(){cfg.rateshowobj.textContent=1*cfg.scalerate,cfg.canvasimgobj.style.width=cfg.originimginfo.width*cfg.scalerate+"px",cfg.canvasimgobj.style.height=cfg.originimginfo.height*cfg.scalerate+"px",cfg.img.width=cfg.originimginfo.width*cfg.scalerate,cfg.img.height=cfg.originimginfo.height*cfg.scalerate,cfg.dfx=(cfg.canvaspartobj.clientWidth-cfg.img.width)/2,cfg.dfy=(cfg.canvaspartobj.clientHeight-cfg.img.height)/2;var e=(cfg.canvaspartwid-cfg.wid)/2,t=(cfg.canvasparthei-cfg.hei)/2,i=(cfg.movepyl.reslenx+e)*cfg.scalerate+cfg.canvaspartwid/2,l=(cfg.movepyl.resleny+t)*cfg.scalerate+cfg.canvasparthei/2;i>=e&&(i=e),l>=t&&(l=t),cfg.movepyl.left=i,cfg.movepyl.top=l,cfg.canvasimgobj.style.left=i+"px",cfg.canvasimgobj.style.top=l+"px"}},{key:"canvastoimg",value:function(e,t){var i=this.cfg;i.canvasobj=this.getId(i.realcanvas),i.cxt=i.canvasobj.getContext("2d");var l=i.canvaspartwid/2-i.wid/2,a=i.canvasparthei/2-i.hei/2;i.dx=Math.abs(e-l)/i.scalerate,i.dy=Math.abs(t-a)/i.scalerate,i.cxt.clearRect(0,0,i.canvasobj.width,i.canvasobj.height),i.cxt.drawImage(i.img,i.dx,i.dy,i.wid/i.scalerate,i.hei/i.scalerate,0,0,i.wid,i.hei)}}]),e}();
export function CFCMimg(param) {
	return new CFCMimg(param)
}
