"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),CFCMimg=function(){function e(t,a){_classCallCheck(this,e),this.initVal(t,a)}return _createClass(e,[{key:"getId",value:function(e){return document.getElementById(e)}},{key:"initVal",value:function(e,t){var a={canvaspart:"canvaspart",id:"canvas",fileid:"files",wid:229,hei:128,scale:2,scalerate:1,scrollid:"progress",scrollsonid:"innergress",rateshow:"rateshow",slider:!1};this.cfg={};_extends(this.cfg,a,e);this.initCommonVal()}},{key:"getStyle",value:function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null)[t]:e.currentStyle[t]}},{key:"getoffset",value:function(e,t){if(null==e)return t;t||((t={}).top=0,t.left=0);var a=this.getStyle(e,"position");if("absolute"==a||"relative"==a){if(e.getBoundingClientRect&&null!=navigator.userAgent.toLowerCase().match(/.(msie)/))return t.top+=e.getBoundingClientRect().top,t.left+=e.getBoundingClientRect().left,t;t.top+=e.offsetTop,t.left+=e.offsetLeft}else t.top+=0,t.left+=0;return this.getoffset(e.parentElement,t)}},{key:"initCommonVal",value:function(){var e=this.cfg;e.slider&&(e.sliderobj=this.getId(e.slider)),e.canvaspartobj=this.getId(e.canvaspart),e.canvasobj=this.getId(e.id),e.fileobj=this.getId(e.fileid),e.scrollobj=this.getId(e.scrollid),e.scrollsonobj=this.getId(e.scrollsonid),e.rateshowobj=this.getId(e.rateshow),null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/)?(console.log(e.fileobj),alert("对不起,您的浏览器版本过低,请升级浏览器")):this.fileclick()}},{key:"fileclick",value:function(){var e=this.cfg,t=this;e.fileobj.onchange=function(){e.fileinfo={},null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/)?(console.log(e.fileobj),alert("对不起,您的浏览器版本过低,请升级浏览器"),e.fileinfo.size=e.fileobj.size,e.fileinfo.type=e.fileobj.value.substring(e.fileobj.value.lastIndexOf("."),e.fileobj.value.length),e.fileinfo.name=e.fileobj.value.substring(e.fileobj.value.lastIndexOf("\\")+1,e.fileobj.value.length),e.fileinfo.path=e.fileobj.value,e.fileinfo.files=e.fileobj):(e.fileinfo.size=this.files[0].size,e.fileinfo.type=this.files[0].type,e.fileinfo.name=this.files[0].name,e.fileinfo.path=this.value,e.fileinfo.files=this.files[0],t.canvas())}}},{key:"canvas",value:function(){var e=this.cfg,t=this;if(e.canvasobj=null,e.canvasobj=this.getId(e.id),e.cxt=e.canvasobj.getContext("2d"),null!=navigator.userAgent.toLowerCase().match(/.(msie)[\/: ]([9.]+)/))console.warn("ie9浏览器,不支持filereader,需要上传文件"),e.img=new Image,e.img.src=e.fileinfo.name,console.log("isie9isie9isie9"),e.img.onload=function(){console.log("isie9isie9isie9onload"),e.dx=(e.canvasobj.width-e.img.width)/2,e.dy=(e.canvasobj.height-e.img.height)/2,e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2,e.cxt.drawImage(e.img,e.dx,e.dy),t.canvasevent(),t.scrollevent()};else{var a=new FileReader;a.readAsDataURL(e.fileinfo.files),a.onload=function(i){e.readerimg=a.result,e.img=new Image,e.img.src=e.readerimg,e.img.onload=function(){e.dx=(e.canvasobj.width-e.img.width)/2,e.dy=(e.canvasobj.height-e.img.height)/2,e.dfx=(e.canvaspartobj.clientWidth-e.img.width)/2-152,e.dfy=(e.canvaspartobj.clientHeight-e.img.height)/2-86,e.canvaspartobj.setAttribute("style","background: url("+e.readerimg+") #f0f7ff "+e.dfx+"px "+e.dfy+"px no-repeat"),e.cxt.drawImage(e.img,e.dx,e.dy),t.canvasevent(),t.scrollevent()}}}}},{key:"canvasevent",value:function(){var e=this.cfg;console.log("canvas event part"),e.canvasoff=this.getoffset(e.canvasobj),console.log(e.canvasoff,"cfg.canvasoffcfg.canvasoff"),e.canvasOFFx=e.canvasoff.left,e.canvasOFFy=e.canvasoff.top,e.canvaspyl={x:0+e.dx,y:0+e.dy};var t={},a={},i=!1;e.canvasobj.onmousedown=function(n){var o=window.event||n;o.preventDefault&&o.preventDefault(),t.x=o.clientX-e.canvasOFFx-e.canvaspyl.x,t.y=o.clientY-e.canvasOFFy-e.canvaspyl.y,i=!0,e.canvasobj.onmousemove=function(n){if(1==i){(n=window.event||n).preventDefault&&n.preventDefault(),a.x=n.clientX-e.canvasOFFx,a.y=n.clientY-e.canvasOFFy,e.canvaspyl.x=a.x-t.x,e.canvaspyl.y=a.y-t.y,e.cxt.clearRect(0,0,e.canvasobj.width,e.canvasobj.height),e.canvaspyl.x+e.img.width<=e.wid&&(e.canvaspyl.x=-(e.img.width-e.wid));var o=e.canvasobj.width-e.canvasobj.width/e.scalerate,l=e.canvasobj.height-e.canvasobj.height/e.scalerate;e.canvaspyl.x-o>=0&&(e.canvaspyl.x=o),e.canvaspyl.y+e.img.height<=e.hei&&(e.canvaspyl.y=-(e.img.height-e.hei)),e.canvaspyl.y-l>=0&&(e.canvaspyl.y=l),console.log(e.canvaspyl.x,e.canvaspyl.x),e.dfx=-e.canvaspyl.x-275+115,e.dfy=-e.canvaspyl.y-150+69,e.canvaspartobj.style.backgroundPosition=-e.dfx+"px "+-e.dfy+"px ",e.cxt.drawImage(e.img,-e.canvaspyl.x+(e.canvasobj.width-e.canvasobj.width/e.scalerate),-e.canvaspyl.y+(e.canvasobj.height-e.canvasobj.height/e.scalerate),e.img.width/e.scalerate,e.img.height/e.scalerate,0,0,e.img.width,e.img.height)}},e.canvasobj.onmouseup=function(t){(t=window.event||t).preventDefault&&t.preventDefault(),e.canvasobj.onmousemove=null,i=!1},e.canvasobj.onmouseout=function(t){(t=window.event||t).preventDefault&&t.preventDefault(),e.canvasobj.onmousemove=null,i=!1}}}},{key:"scrollevent",value:function(){var e=this.cfg;if(e.slider)e.sliderobj.onmousemove=function(t){t=window.event||t,console.log(e.sliderobj.value),e.rateshowobj.textContent=e.sliderobj.value,e.scalerate=e.sliderobj.value,e.cxt.clearRect(0,0,e.canvasobj.width,e.canvasobj.height),e.canvasobj.width-e.canvasobj.width/e.sliderobj.value-e.canvaspyl.x<=0?e.cxt.drawImage(e.img,0,0,e.img.width/e.sliderobj.value,e.img.height/e.sliderobj.value,0,0,e.img.width,e.img.height):e.cxt.drawImage(e.img,-e.canvaspyl.x+(e.canvasobj.width-e.canvasobj.width/e.sliderobj.value),-e.canvaspyl.y+(e.canvasobj.height-e.canvasobj.height/e.sliderobj.value),e.img.width/e.sliderobj.value,e.img.height/e.sliderobj.value,0,0,e.img.width,e.img.height)};else{console.log("模拟滚动条进入");var t=this.cfg;console.log("scroll event");var a=this.getoffset(t.scrollobj),i=a.left,n=(a.top,{}),o={},l={x:0,y:0},s=!1;t.scrollobj.onmousedown=function(e){e.preventDefault(),n.x=e.clientX-i,n.x>t.scrollobj.clientWidth?t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px":t.scrollsonobj.style.width=n.x+"px",s=!0,t.scrollobj.onmousemove=function(e){1==s&&(e.preventDefault(),o.x=e.clientX-i,l.x=o.x-n.x,l.x>=t.scrollobj.clientWidth&&(l.x=t.scrollobj.clientWidth),l.x+n.x>t.scrollobj.clientWidth?t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px":t.scrollsonobj.style.width=l.x+n.x+"px",t.scalerate=((l.x+n.x)/(t.scrollobj.clientWidth/(t.scale-1))+1).toFixed(1),t.rateshowobj.textContent=1*t.scalerate+1,t.cxt.clearRect(0,0,t.canvasobj.width,t.canvasobj.height),t.cxt.drawImage(t.img,-t.canvaspyl.x,-t.canvaspyl.y,t.img.width/t.scalerate,t.img.height/t.scalerate,0,0,t.img.width,t.img.height))},t.scrollobj.onmouseup=function(e){e.preventDefault(),t.scrollobj.onmousemove=null,e.clientX-i>t.scrollobj.clientWidth?t.scrollsonobj.style.width=t.scrollobj.clientWidth+"px":t.scrollsonobj.style.width=e.clientX-i+"px",t.scalerate=((l.x+n.x)/(t.scrollobj.clientWidth/(t.scale-1))+1).toFixed(1),t.rateshowobj.textContent=1*t.scalerate+1,console.log(t.scalerate,"---------------"),t.cxt.clearRect(0,0,t.canvasobj.width,t.canvasobj.height),t.cxt.drawImage(t.img,-t.canvaspyl.x,-t.canvaspyl.y,t.img.width/t.scalerate,t.img.height/t.scalerate,0,0,t.img.width,t.img.height),s=!1},t.scrollobj.onmouseout=function(e){e.preventDefault(),t.scrollobj.onmousemove=null,s=!1}}}}}]),e}();
export function CFCMimg(param) {
	return new CFCMimg(param)
}
